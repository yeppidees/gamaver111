<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>뽕빨 방탈출</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: #000; color: #0f0; font-family: 'Courier New', 'Malgun Gothic', monospace; margin: 0; padding: 10px; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        #status-bar { display: flex; justify-content: space-between; font-size: 11px; border-bottom: 2px solid #040; padding: 8px; background: #010; }
        #log-container { flex: 1; overflow-y: auto; padding: 15px; margin: 10px 0; background: rgba(0, 5, 0, 0.95); border: 1px solid #050; border-radius: 5px; box-shadow: inset 0 0 30px #020; }
        #log { font-size: 14px; line-height: 1.8; color: #bbb; }

        .boss-msg { color: #f0f; font-weight: bold; background: rgba(255, 0, 255, 0.15); padding: 5px; display: block; }
        .erotic { color: #ff69b4; border-left: 3px solid #ff69b4; padding-left: 10px; margin: 10px 0; font-weight: bold; }
        .critical { color: #f00; font-weight: bold; text-shadow: 0 0 10px #f00; animation: shake 0.5s infinite; }
        .hint-box { color: #ff0; background: #330; padding: 2px 5px; animation: fadeOut 3s forwards; display: inline-block; }
        
        #controls { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; min-height: 140px; }
        button { background: #010; color: #0f0; border: 1px solid #0a0; border-radius: 4px; padding: 12px 5px; font-size: 13px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:hover { background: #050; }
        button:active { background: #0f0; color: #000; }
        
        #setup input { width: 100%; background: #000; color: #0f0; border: 1px solid #0a0; padding: 15px; font-size: 16px; text-align: center; margin-bottom: 10px; }
        
        @keyframes fadeOut { 0%, 90% { opacity: 1; } 100% { opacity: 0; } }
        @keyframes shake { 0% { transform: translate(0); } 25% { transform: translate(2px); } 50% { transform: translate(-2px); } 100% { transform: translate(0); } }
    </style>
</head>
<body>

<div id="status-bar">
    <div>LAYER: <span id="area-val">1</span>/6</div>
    <div>TIME: <span id="timer">900</span>s</div>
    <div>INV: <span id="inv-val">0</span></div>
</div>

<div id="log-container">
    <div id="log">
        <p class="critical" style="text-align:center;">[ 방탈출 ]</p>
        <p>여섯 명의 지배자가 기다리는 지옥의 문이 열렸습니다. 
        단서를 찾지 못하면 당신들은 보스의 영구적인 성노리개가 되어 육체가 해체될 것입니다.</p>
        <p>함께 입장할 자들의 이름을 적으십시오 (최대 4명, 쉼표 구분).</p>
    </div>
</div>

<div id="action-area">
    <div id="setup">
        <input type="text" id="name-input" placeholder="철수, 영희, 민수, 미나">
        <button onclick="initGame()" style="width:100%; height:60px; font-size:18px;">피의 계약 및 입장</button>
    </div>
    <div id="controls" style="display:none;"></div>
</div>

<script>
    let players = [];
    let inventory = [];
    let timeLeft = 900;
    let currentArea = 1;
    let currentRoom = 1;
    let areaCode = "";
    let audioCtx = null;

    // --- 스테이지 & 보스 데이터 (R19 스토리 포함) ---
    const worldData = [
        null,
        {
            name: "음탕한 무당 바리",
            story: "마을 아이들의 안구를 뽑아 영생의 술을 빚던 무당. 지옥에서도 그 갈증을 풀기 위해 산 자의 체액을 탐합니다.",
            intro: "깔깔! 싱싱한 구멍들이 제 발로 찾아왔구나. 너희의 비명으로 제단을 적셔주마.",
            rooms: [
                { d: "사당 입구: 썩은 시신들이 기괴한 교미 자세로 굳어있습니다.", opt: ["부적 조사", "시체 뒤지기"] },
                { d: "피의 제단: 아이들의 머리카락으로 짠 밧줄이 당신들의 목을 노립니다.", opt: ["제단 수색", "주문 읽기"] },
                { d: "무당의 침실: 음란한 향취가 진동하며 이성을 마비시킵니다.", opt: ["벽면 관찰", "서랍 열기"] }
            ]
        },
        {
            name: "심해의 창녀 세이렌",
            story: "난파된 선원들을 유혹해 촉수로 온몸을 꿰뚫어 알을 낳는 심해의 괴물.",
            intro: "바다보다 깊고 뜨거운 곳으로 안내해줄게. 내 촉수는 아주 자비가 없단다.",
            rooms: [
                { d: "젖은 복도: 벽면에서 끈적한 점액이 흘러나와 발을 묶습니다.", opt: ["점액 조사", "천장 보기"] },
                { d: "산란실: 거대한 알들이 맥동하며 신음소리를 내고 있습니다.", opt: ["알 파괴", "부화 흔적 수색"] }
            ]
        },
        {
            name: "도살자 잭",
            story: "고통 속에서 피어나는 쾌락을 즐기는 성도착증 살인마. 당신의 살점을 정교하게 발라내려 합니다.",
            intro: "새로운 고기가 왔군. 껍질을 벗길 때 터져나올 네 핑크빛 속살이 기대되는걸?",
            rooms: [
                { d: "냉동 창고: 갈고리에 걸린 육체들이 정액과 피로 뒤범벅되어 있습니다.", opt: ["갈고리 조사", "바닥 수색"] },
                { d: "해부실: 기괴한 성인 도구들과 수술용 칼들이 나열되어 있습니다.", opt: ["도구함 열기", "일지 읽기"] }
            ]
        },
        { name: "몽마 릴리스", story: "꿈속에서 정기를 빨아먹고 껍데기만 남기는 여왕.", intro: "지옥의 쾌락이 어떤 건지 온몸으로 가르쳐줄게.", rooms: [{d: "안개의 방", opt: ["향로 조사", "거울 보기"]}] },
        { name: "가죽 수집가 노페이스", story: "자신의 얼굴을 위해 타인의 안면과 성기를 도려내는 악귀.", intro: "네 매끄러운 피부... 내 옷으로 딱이겠어.", rooms: [{d: "가죽 건조실", opt: ["가죽 조사", "도구함 수색"]}] },
        { name: "타락의 신 마더", story: "모든 악의 근원이자 지옥의 자궁. 당신들을 다시 태어나게(?) 할 것입니다.", intro: "내 안으로 들어오렴. 영원한 고통의 안식을 주마.", rooms: [{d: "자궁의 심부", opt: ["혈관 조사", "박동 청취"]}] }
    ];

    // --- 효과음 시스템 ---
    function playSfx(f, type='sine', dur=0.3, vol=0.1) {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(f, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + dur);
    }

    // --- 게임 진행 로직 ---
    function addLog(msg, cls = '') {
        const log = document.getElementById('log');
        const p = document.createElement('p');
        if (cls) p.className = cls;
        p.innerHTML = `> ${msg}`;
        log.appendChild(p);
        document.getElementById('log-container').scrollTop = log.scrollHeight;
    }

    function initGame() {
        const input = document.getElementById('name-input').value;
        if (!input) return;
        players = input.split(',').map(n => n.trim()).slice(0, 4);
        document.getElementById('setup').style.display = 'none';
        document.getElementById('controls').style.display = 'grid';
        playSfx(150, 'square', 0.8);
        startTimer();
        loadArea();
    }

    function startTimer() {
        setInterval(() => {
            if(timeLeft > 0) {
                timeLeft--;
                document.getElementById('timer').innerText = timeLeft;
                if(timeLeft <= 0) die("시간 초과. 당신들은 보스의 영원한 고기 인형이 되었습니다.");
            }
        }, 1000);
    }

    function loadArea() {
        currentRoom = 1;
        areaCode = Math.floor(1000 + Math.random() * 9000).toString();
        document.getElementById('area-val').innerText = currentArea;
        const data = worldData[currentArea];
        addLog(`[제 ${currentArea}층: ${data.name}]`, 'critical');
        addLog(data.story, 'story-text');
        playSfx(50, 'sawtooth', 1.2, 0.2);
        renderRoom();
    }

    function renderRoom() {
        const stage = worldData[currentArea];
        if (currentRoom <= stage.rooms.length) {
            const roomData = stage.rooms[currentRoom - 1];
            addLog(`방 ${currentRoom}: ${roomData.d}`);
            const btns = roomData.opt.map(o => ({ t: o, f: "actionInvestigate" }));
            updateButtons(btns);
        } else {
            addLog(`<span class="boss-msg">"${stage.intro}"</span>`, 'erotic');
            updateButtons([
                { t: "암호 기믹 풀기 (Escape)", f: "actionSolve" },
                { t: "필사적 저항 (Battle)", f: "actionFight" },
                { t: "몸을 바쳐 유혹 (Erotic)", f: "actionSubmit" }
            ]);
        }
    }

    // --- 액션 함수들 ---
    window.actionInvestigate = () => {
        const p = players[Math.floor(Math.random() * players.length)];
        playSfx(600, 'sine', 0.2);
        addLog(`${p}(이)가 주변을 샅샅이 뒤집니다...`);
        
        const rand = Math.random();
        if (rand > 0.6) {
            const hint = (rand > 0.8) ? `[${areaCode.substring(0,2)}XX]` : `[XX${areaCode.substring(2,4)}]`;
            addLog(`피로 쓰인 숫자 발견: <span class="hint-box">${hint}</span> (3초 후 소멸)`, 'hint-info');
            setTimeout(() => {
                const hintElements = document.getElementsByClassName('hint-box');
                if(hintElements.length > 0) hintElements[0].remove();
            }, 3000);
        } else if (rand > 0.3) {
            const item = ["윤활제", "녹슨 칼", "마비 독침", "열쇠"][Math.floor(Math.random()*4)];
            inventory.push(item);
            addLog(`아이템 획득: [${item}]`);
            document.getElementById('inv-val').innerText = inventory.length;
        } else {
            addLog(`조사 도중 보이지 않는 촉수가 ${p}의 허벅지를 훑고 지나갑니다!`, 'erotic');
        }
        currentRoom++;
        setTimeout(renderRoom, 1000);
    };

    window.actionSolve = () => {
        const code = prompt("4자리 암호를 입력하십시오.");
        if (code === areaCode) {
            playSfx(1000, 'sine', 0.8);
            addLog("기믹 해제! 보스가 비명을 지르며 쾌락 속에 소멸합니다.", 'critical');
            nextStage();
        } else {
            playSfx(40, 'square', 1);
            die("암호 실패. 보스가 당신들의 사지를 결박하고 강제로 유린을 시작합니다.");
        }
    };

    window.actionFight = () => {
        let chance = 0.4 + (inventory.length * 0.1);
        if (Math.random() < chance) {
            addLog("처절한 혈투 끝에 보스의 심장을 꿰뚫었습니다!", 'critical');
            nextStage();
        } else {
            const p = players[Math.floor(Math.random() * players.length)];
            addLog(`${p}(이)가 보스에게 제압당해 노골적인 가학을 당합니다!`, 'erotic');
            timeLeft -= 150;
            playSfx(80, 'sawtooth', 1);
        }
    };

    window.actionSubmit = () => {
        addLog("보스에게 굴복하여 옷을 벗고 몸을 바칩니다...", 'erotic');
        if (Math.random() > 0.6) {
            addLog("보스가 당신들의 신음과 봉사에 만족하여 길을 열어줍니다.");
            nextStage();
        } else {
            die("보스는 당신들을 단순한 고기 인형으로 사용한 뒤 폐기했습니다.");
        }
    };

    function nextStage() {
        if (currentArea < 6) {
            currentArea++;
            setTimeout(loadArea, 1500);
        } else {
            win();
        }
    }

    function updateButtons(btns) {
        const ctrl = document.getElementById('controls');
        ctrl.innerHTML = '';
        btns.forEach(b => {
            const btn = document.createElement('button');
            btn.innerText = b.t;
            btn.onclick = () => { window[b.f](); };
            ctrl.appendChild(btn);
        });
    }

    function die(msg) {
        document.body.innerHTML = `<div style="color:red; text-align:center; padding-top:100px; background:#000; height:100vh;">
            <h1 class="critical" style="font-size:30px;">DEATH END</h1><p>${msg}</p>
            <button onclick="location.reload()" style="margin-top:40px; width:200px; height:50px;">영혼 재생성</button></div>`;
    }

    function win() {
        document.body.innerHTML = `<div style="color:#0f0; text-align:center; padding-top:100px; background:#000; height:100vh;">
            <h1 style="font-size:30px;">CONQUEROR</h1><p>지옥의 6층을 모두 정복하고 생존했습니다.</p></div>`;
    }
</script>
</body>
</html>
